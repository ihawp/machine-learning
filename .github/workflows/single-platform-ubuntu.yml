name: Multi-Platform Vcpkg Manifest Build

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    runs-on: ${{ matrix.os }}

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    # --- Use the correct marketplace action for vcpkg setup and manifest install ---
    - name: Setup Vcpkg and Install Dependencies
      uses: lukka/run-vcpkg@v11
      with:
        # Automatically detects vcpkg.json and runs 'vcpkg install'
        runVcpkgInstall: true 
        # Caches the vcpkg executable and built packages
        vcpkgDirectory: '${{ runner.temp }}/vcpkg'
        vcpkgRootPath: '${{ runner.temp }}/vcpkg'


    - name: Configure CMake
      # The 'lukka/run-vcpkg' action automatically sets CMAKE_TOOLCHAIN_FILE env var
      run: |
        # Use simple 'cmake -B build' command as env vars are set
        cmake -B build -S .

        # Set build type explicitly for non-Windows platforms
        if [ "${{ matrix.os }}" != "windows-latest" ]; then
          cmake -B build -DCMAKE_BUILD_TYPE=Release -S .
        fi

    - name: Build Project
      run: cmake --build build --config Release

    # Optional: Run Tests
    # - name: Test Project
    #   working-directory: ${{ github.workspace }}/build
    #   run: ctest --build-config Release
