name: Multi-Platform Vcpkg Manifest Build

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    # Use a matrix strategy to run on all three platforms
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest, macos-latest]

    runs-on: ${{ matrix.os }}

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    # This action sets up vcpkg and automatically handles the toolchain integration
    - name: Setup Vcpkg
      uses: vcpkg-tool/setup-vcpkg@v1
      with:
        # This parameter ensures vcpkg installs required dependencies before CMake runs
        run-vcpkg-install: true

    - name: Configure CMake
      # The VCPKG_ROOT variable is automatically set by the 'setup-vcpkg' action above
      run: |
        cmake -B build -S .
        # The above line works automatically because VCPKG_ROOT is set.
        # We handle build type differently for single-config generators (Linux/macOS)
        if [ "${{ matrix.os }}" != "windows-latest" ]; then
          cmake -B build -DCMAKE_BUILD_TYPE=Release -S .
        fi

    - name: Build Project
      run: cmake --build build --config Release

    # Optional: Run Tests
    # - name: Test Project
    #   working-directory: ${{ github.workspace }}/build
    #   run: ctest --build-config Release
